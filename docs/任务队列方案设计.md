# 任务队列

使用 WP Cron 来处理耗时的任务，比如发送邮件，导入数据等。

为了减少开发量，使用第三方库：https://github.com/SebKay/wp-queued-jobs

## 安装包

```bash
composer require sebkay/wp-queued-jobs
```

## 使用

创建任务

```php
use WpQueuedJobs\Jobs\Job;

class TransferJob extends Job
{
    public function handle()
    {
        // Handle the job
        // Use $this->data to access what was passed with the job when it was added to the queue
        Pay::config($this->config);

        $result = Pay::alipay()->transfer($this->data);
    }
}
```

任务入列

```php
wpj()
    ->addJob(TransferJob::class, [
        'out_biz_no' => '202106051432', // 转账编号，自己生成并保存
        'trans_amount' => '0.01', // 金额，单位元
        'product_code' => 'TRANS_ACCOUNT_NO_PWD',
        'biz_scene' => 'DIRECT_TRANSFER',
        'payee_info' => [
            'identity' => 'ghdhjw7124@sandbox.com', // 支付宝账户
            'identity_type' => 'ALIPAY_LOGON_ID',
            'name' => '沙箱环境'
        ],
    ])
    ->dispatch();
```
