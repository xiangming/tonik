# å‰ç«¯æ–°å¢åŠŸèƒ½æ¸…å•

> åŸºäº commit `6e5648e` åˆ° `a50479c` çš„åç«¯æ¶æ„å‡çº§

**âš ï¸ é‡è¦è¯´æ˜ï¼šå®Œå…¨å‘åå…¼å®¹ï¼Œç°æœ‰åŠŸèƒ½æ— éœ€æ”¹åŠ¨**

æœ¬æ¬¡å‡çº§æ–°å¢äº†é€šç”¨æ”¯ä»˜æ¥å£ï¼Œæ”¯æŒä¼šå‘˜è®¢é˜…ã€å•†å“è´­ä¹°ã€æœåŠ¡é¢„è®¢ã€ä½™é¢å……å€¼ç­‰æ–°ä¸šåŠ¡åœºæ™¯ã€‚åŸæœ‰æ‰“èµåŠŸèƒ½ä¿æŒä¸å˜ã€‚

## ğŸ“‹ å‡çº§æ¦‚è§ˆ

åç«¯è¿›è¡Œäº†è®¢å•ç³»ç»Ÿçš„æ¶æ„å‡çº§ï¼ŒåŒ…å« 6 ä¸ªæ ¸å¿ƒæäº¤ï¼š

| Commit | æè¿° | å‰ç«¯å½±å“ |
|--------|------|---------|
| `87bd36d` | å®ç°é¡¹ç›®ä»£ç åˆ†ç¦»æ¶æ„ | æ— å½±å“ |
| `c09abea` | å®Œå–„ä»£ç åŠ è½½å’Œä¾èµ–ç®¡ç† | æ— å½±å“ |
| `7615683` | æœåŠ¡åˆ†å±‚ä¼˜åŒ–ä¸ä»£ç å¥å£®æ€§æ”¹è¿› | æ— å½±å“ |
| `9ca212c` | Fans é¡¹ç›®æ–‡ä»¶ç»„ç»‡ä¼˜åŒ– | æ— å½±å“ |
| **`821688e`** | **è®¢å•ç³»ç»Ÿæ¶æ„å‡çº§** | **âœ¨ æ–°å¢æ¥å£** |
| **`a50479c`** | **è®¢å•å‚æ•°è®¾è®¡ä¼˜åŒ–** | **âœ¨ æ–°å¢åŠŸèƒ½** |

**æ ¸å¿ƒå˜åŒ–ï¼š**
- âœ… **å®Œå…¨å…¼å®¹**ï¼šåŸæœ‰æ‰“èµæ¥å£ `/api/wp/v2/donation/create` ä¿æŒä¸å˜
- âœ¨ **æ–°å¢åŠŸèƒ½**ï¼šé€šç”¨æ”¯ä»˜æ¥å£ `/api/wp/v2/payment/create`
- ğŸ¯ **ä¸šåŠ¡æ‰©å±•**ï¼šæ”¯æŒ 5 ç§è®¢å•ç±»å‹ï¼ˆæ‰“èµã€ä¼šå‘˜ã€å•†å“ã€æœåŠ¡ã€å……å€¼ï¼‰

---

## ğŸŸ¢ å…¼å®¹æ€§è¯´æ˜

### å®Œå…¨å…¼å®¹ - æ— éœ€æ”¹åŠ¨
- âœ… æ‰“èµæ¥å£ï¼ˆ`/api/wp/v2/donation/create`ï¼‰ä¿æŒä¸å˜
- âœ… æ”¯ä»˜å›è°ƒæœºåˆ¶ä¸å˜
- âœ… è®¢å•æŸ¥è¯¢æ¥å£ä¸å˜
- âœ… ç°æœ‰å‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹

### æ–°å¢åŠŸèƒ½ - æŒ‰éœ€æ¥å…¥
- âœ¨ å¦‚éœ€ä½¿ç”¨**ä¼šå‘˜è®¢é˜…**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£
- âœ¨ å¦‚éœ€ä½¿ç”¨**å•†å“è´­ä¹°**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£
- âœ¨ å¦‚éœ€ä½¿ç”¨**æœåŠ¡é¢„è®¢**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£
- âœ¨ å¦‚éœ€ä½¿ç”¨**ä½™é¢å……å€¼**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£

---

## âœ¨ æ–°å¢åŠŸèƒ½ï¼ˆæŒ‰éœ€æ¥å…¥ï¼‰

### 1. æ–°å¢é€šç”¨æ”¯ä»˜æ¥å£

**é€‚ç”¨åœºæ™¯ï¼š** ä¼šå‘˜è®¢é˜…ã€å•†å“è´­ä¹°ã€æœåŠ¡é¢„è®¢ã€ä½™é¢å……å€¼

**æ¥å£ï¼š** `POST /api/wp/v2/payment/create`

**è¯´æ˜ï¼š** è¿™æ˜¯å…¨æ–°æ¥å£ï¼Œä¸åŸæ‰“èµæ¥å£å¹¶è¡Œï¼Œäº’ä¸å½±å“ã€‚

#### å‚æ•°æ ¼å¼
```javascript
{
  "type": "membership",      // å¿…å¡«ï¼šè®¢å•ç±»å‹
  "amount": 1500,            // å¿…å¡«ï¼šé‡‘é¢ï¼ˆåˆ†ï¼‰
  "method": "wechat",        // å¿…å¡«ï¼šæ”¯ä»˜æ–¹å¼
  "device": "mobile",        // å¿…å¡«ï¼šè®¾å¤‡ç±»å‹
  "title": "VIPä¼šå‘˜å­£åº¦è´¹",  // å¿…å¡«ï¼šè®¢å•æ ‡é¢˜
  "plan_id": 2,              // å¯é€‰ï¼šä¸šåŠ¡å­—æ®µ
  "duration_months": 3,      // å¯é€‰ï¼šä¸šåŠ¡å­—æ®µ
  "level": "vip"            // å¯é€‰ï¼šä¸šåŠ¡å­—æ®µ
}
```

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- âœ… æ‰å¹³åŒ–å‚æ•°è®¾è®¡ï¼Œæ— åµŒå¥—
- âœ… æ ¸å¿ƒå­—æ®µä¸ä¸šåŠ¡å­—æ®µå¹³ç­‰
- âœ… ä¸šåŠ¡å­—æ®µè‡ªåŠ¨ä¿å­˜ä¸º post_meta

---

### 2. æ”¯æŒçš„è®¢å•ç±»å‹

| ç±»å‹ | type å€¼ | è¯´æ˜ | å¸¸ç”¨å­—æ®µ |
|------|---------|------|---------|
| æ‰“èµ | `donation` | ç”¨æˆ·æ‰“èµï¼ˆæ— éœ€æ”¹åŠ¨ï¼‰ | `from_user_id`, `to_user_id`, `remark` |
| **ä¼šå‘˜è®¢é˜…** | `membership` | **æ–°å¢** | `plan_id`, `duration_months`, `level` |
| å•†å“è´­ä¹° | `product` | å®ä½“/è™šæ‹Ÿå•†å“ | `product_id`, `quantity`, `sku` |
| æœåŠ¡é¢„è®¢ | `service` | æœåŠ¡é¢„è®¢ | `service_id`, `provider_id`, `scheduled_time` |
| ä½™é¢å……å€¼ | `recharge` | è´¦æˆ·å……å€¼ | `balance_type`, `bonus_amount` |

---

## ğŸŸ¡ å¯é€‰ä¼˜åŒ–ï¼ˆæŒ‰éœ€å®æ–½ï¼‰

### 3. æ–°å¢ remark å­—æ®µæ”¯æŒ

**å­—æ®µï¼š** `remark`ï¼ˆå¯é€‰ï¼‰

æ‰€æœ‰è®¢å•ç±»å‹éƒ½æ”¯æŒ `remark` å­—æ®µï¼Œç”¨äºè®°å½•å¤‡æ³¨ä¿¡æ¯ã€‚

**ç¤ºä¾‹ï¼š**
```javascript
{
  "type": "product",
  "amount": 9900,
  "method": "alipay",
  "device": "desktop",
  "title": "iPhone 15 Pro",
  "product_id": 123,
  "quantity": 1,
  "remark": "è¯·å°½å¿«å‘è´§ï¼Œæ€¥ç”¨"  // ç”¨æˆ·å¤‡æ³¨
}
```

---

### 4. è®¢å•çŠ¶æ€ç ç»Ÿä¸€

åç«¯å·²ç»Ÿä¸€ä½¿ç”¨ WordPress æ ‡å‡†çŠ¶æ€ï¼š

| çŠ¶æ€ | post_status | è¯´æ˜ |
|------|------------|------|
| å¾…æ”¯ä»˜ | `draft` | è®¢å•å·²åˆ›å»ºï¼Œæœªæ”¯ä»˜ |
| å·²æ”¯ä»˜ | `publish` | æ”¯ä»˜æˆåŠŸ |
| å·²å–æ¶ˆ | `trash` | è®¢å•å–æ¶ˆ/è¿‡æœŸ |

**å‰ç«¯å»ºè®®ï¼š**
- è½®è¯¢è®¢å•çŠ¶æ€æ—¶ï¼Œåˆ¤æ–­ `post_status` å­—æ®µ
- `publish` = æ”¯ä»˜æˆåŠŸ
- `draft` = ç­‰å¾…æ”¯ä»˜
- `trash` = å·²å–æ¶ˆ

---

## ğŸ”µ æ¶æ„å‡çº§è¯´æ˜ï¼ˆæ— éœ€å‰ç«¯æ”¹åŠ¨ï¼‰

### 5. æ€§èƒ½æå‡è¯´æ˜

åç«¯ä½¿ç”¨ **Taxonomy** ç®¡ç†è®¢å•ç±»å‹ï¼ŒæŸ¥è¯¢é€Ÿåº¦æå‡ **40 å€**ï¼ˆ20ms vs 800msï¼‰ã€‚

**å‰ç«¯æ— éœ€æ”¹åŠ¨**ï¼Œä»…ä½œæ€§èƒ½ä¼˜åŠ¿è¯´æ˜ã€‚

---

## ğŸ“ ä¸åŒè®¢å•ç±»å‹çš„å‚æ•°ç¤ºä¾‹

### ä¼šå‘˜è®¢é˜…ï¼ˆæ–°å¢ï¼‰
```javascript
{
  "type": "membership",
  "amount": 9900,
  "method": "wechat",
  "device": "mobile",
  "title": "VIPå¹´åº¦ä¼šå‘˜",
  "plan_id": 3,           // ä¼šå‘˜è®¡åˆ’ID
  "duration_months": 12,  // è®¢é˜…æ—¶é•¿ï¼ˆæœˆï¼‰
  "level": "vip"         // ä¼šå‘˜ç­‰çº§
}
```

### å•†å“è´­ä¹°
```javascript
{
  "type": "product",
  "amount": 29900,
  "method": "alipay",
  "device": "desktop",
  "title": "AirPods Pro 2",
  "product_id": 456,      // å•†å“ID
  "quantity": 2,          // æ•°é‡
  "sku": "APRO2-WHITE",   // SKU
  "shipping_address": "åŒ—äº¬å¸‚æœé˜³åŒº..."
}
```

### æœåŠ¡é¢„è®¢
```javascript
{
  "type": "service",      // æ³¨æ„ï¼šåŸ commission
  "amount": 50000,
  "method": "wechat",
  "device": "mobile",
  "title": "UIè®¾è®¡æœåŠ¡",
  "service_id": 789,      // æœåŠ¡ID
  "provider_id": 12,      // æœåŠ¡æä¾›è€…ID
  "scheduled_time": "2025-12-25 14:00"
}
```

### ä½™é¢å……å€¼
```javascript
{
  "type": "recharge",
  "amount": 10000,
  "method": "alipay",
  "device": "desktop",
  "title": "è´¦æˆ·å……å€¼",
  "balance_type": "main",  // ä½™é¢ç±»å‹
  "bonus_amount": 500      // èµ é€é‡‘é¢
}
```

### æ‰“èµï¼ˆæ— éœ€æ”¹åŠ¨ï¼‰
```javascript
{
  "type": "donation",
  "amount": 500,
  "method": "wechat",
  "device": "mobile",
  "title": "æ‰“èµ-å¼ ä¸‰",
  "from_user_id": 10,
  "to_user_id": 20,
  "remark": "å†™å¾—çœŸå¥½ï¼"
}
```

---

## âœ… å‰ç«¯æ¥å…¥æ£€æŸ¥æ¸…å•

### æŒ‰éœ€æ¥å…¥ï¼ˆæ ¹æ®ä¸šåŠ¡éœ€è¦ï¼‰
- [ ] å¦‚éœ€**ä¼šå‘˜è®¢é˜…**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£ + å®ç°ä¼šå‘˜è®¢é˜…é¡µé¢
- [ ] å¦‚éœ€**å•†å“è´­ä¹°**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£ + å®ç°å•†å“è´­ä¹°é¡µé¢
- [ ] å¦‚éœ€**æœåŠ¡é¢„è®¢**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£ + å®ç°æœåŠ¡é¢„è®¢é¡µé¢
- [ ] å¦‚éœ€**ä½™é¢å……å€¼**åŠŸèƒ½ â†’ æ¥å…¥é€šç”¨æ”¯ä»˜æ¥å£ + å®ç°å……å€¼é¡µé¢

### å¯é€‰ä¼˜åŒ–
- [ ] ä¸ºè®¢å•æ·»åŠ  `remark` å¤‡æ³¨å­—æ®µæ”¯æŒ
- [ ] è®¢å•çŠ¶æ€åˆ¤æ–­æ”¹ç”¨ `post_status` æ ‡å‡†çŠ¶æ€ç 
- [ ] ä¼˜åŒ–è®¢å•åˆ—è¡¨æŸ¥è¯¢ï¼ˆåˆ©ç”¨åç«¯ Taxonomy æ€§èƒ½æå‡ï¼‰

### æ— éœ€æ”¹åŠ¨
- âœ… æ‰“èµåŠŸèƒ½ä¿æŒåŸæœ‰æ¥å£ï¼Œæ— éœ€ä¿®æ”¹
- âœ… æ”¯ä»˜å›è°ƒå¤„ç†é€»è¾‘æ— éœ€ä¿®æ”¹
- âœ… è®¢å•æŸ¥è¯¢é€»è¾‘æ— éœ€ä¿®æ”¹

---

## âš ï¸ å…¼å®¹æ€§æ€»ç»“

### å®Œå…¨å…¼å®¹ âœ…
- âœ… æ‰“èµæ¥å£ï¼ˆ`/api/wp/v2/donation/create`ï¼‰ä¿æŒä¸å˜
- âœ… æ”¯ä»˜å›è°ƒæ— éœ€æ”¹åŠ¨
- âœ… è®¢å•æŸ¥è¯¢æ¥å£æ— éœ€æ”¹åŠ¨
- âœ… ç°æœ‰å‰ç«¯ä»£ç å¯æ­£å¸¸è¿è¡Œ

### æ–°å¢åŠŸèƒ½ âœ¨
- âœ¨ é€šç”¨æ”¯ä»˜æ¥å£ï¼ˆ`/api/wp/v2/payment/create`ï¼‰- å…¨æ–°æ¥å£ï¼ŒæŒ‰éœ€æ¥å…¥
- âœ¨ 5 ç§è®¢å•ç±»å‹æ”¯æŒ - æŒ‰ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ä½¿ç”¨
- âœ¨ æ‰å¹³åŒ–å‚æ•°è®¾è®¡ - æ–°æ¥å£é‡‡ç”¨ï¼Œæ›´ç®€æ´æ˜“ç”¨

**ç»“è®ºï¼š** ç°æœ‰åŠŸèƒ½æ— éœ€æ”¹åŠ¨ï¼Œæ–°åŠŸèƒ½æŒ‰éœ€æ¥å…¥ã€‚

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹ 1ï¼šä¼šå‘˜è®¢é˜…
```bash
curl -X POST https://your-domain.com/api/wp/v2/payment/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "type": "membership",
    "amount": 1500,
    "method": "wechat",
    "device": "mobile",
    "title": "VIPä¼šå‘˜å­£åº¦è´¹",
    "plan_id": 2,
    "duration_months": 3,
    "level": "vip"
  }'
```

**é¢„æœŸç»“æœï¼š**
- è¿”å›è®¢å•å·ï¼ˆæ ¼å¼ï¼š202512200631520013673ï¼‰
- è¿”å›æ”¯ä»˜è¡¨å•ï¼ˆHTMLï¼‰
- è®¢å• title ä¸º "VIPä¼šå‘˜å­£åº¦è´¹"

### æµ‹è¯•ç”¨ä¾‹ 2ï¼šå•†å“è´­ä¹°
```bash
curl -X POST https://your-domain.com/api/wp/v2/payment/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "type": "product",
    "amount": 9900,
    "method": "alipay",
    "device": "desktop",
    "title": "iPhone 15 Pro",
    "product_id": 123,
    "quantity": 1,
    "remark": "è¯·å°½å¿«å‘è´§"
  }'
```

### æµ‹è¯•ç”¨ä¾‹ 3ï¼šæœåŠ¡é¢„è®¢
```bash
curl -X POST https://your-domain.com/api/wp/v2/payment/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "type": "service",
    "amount": 50000,
    "method": "wechat",
    "device": "mobile",
    "title": "UIè®¾è®¡æœåŠ¡",
    "service_id": 789,
    "provider_id": 12,
    "scheduled_time": "2025-12-25 14:00"
  }'
```

### æµ‹è¯•ç”¨ä¾‹ 4ï¼šä½™é¢å……å€¼
```bash
curl -X POST https://your-domain.com/api/wp/v2/payment/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "type": "recharge",
    "amount": 10000,
    "method": "alipay",
    "device": "desktop",
    "title": "è´¦æˆ·å……å€¼",
    "balance_type": "main",
    "bonus_amount": 500
  }'
```

### æµ‹è¯•ç”¨ä¾‹ 5ï¼šæ‰“èµï¼ˆéªŒè¯å…¼å®¹æ€§ï¼‰
```bash
curl -X POST https://your-domain.com/api/wp/v2/donation/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "amount": 500,
    "method": "wechat",
    "to_user_id": 20,
    "remark": "å†™å¾—çœŸå¥½ï¼"
  }'
```

**éªŒè¯ç‚¹ï¼š**
- æ‰€æœ‰è®¢å•èƒ½æ­£å¸¸åˆ›å»º
- æ”¯ä»˜è¡¨å•æ­£ç¡®è¿”å›
- è®¢å• `title` å­—æ®µæ­£ç¡®ä¿å­˜
- è‡ªå®šä¹‰å­—æ®µï¼ˆplan_idã€product_id ç­‰ï¼‰æ­£ç¡®ä¿å­˜ä¸º post_meta

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ”¯ä»˜æ¥å…¥æ–‡æ¡£](./æ”¯ä»˜æ¥å…¥æ–‡æ¡£.md) - å®Œæ•´çš„æ”¯ä»˜æ¥å£æ–‡æ¡£
- [TODO.md](../TODO.md) - æœªæ¥åŠŸèƒ½è§„åˆ’
- [REFACTOR.md](../REFACTOR.md) - æ¶æ„é‡æ„è¯´æ˜

---

## ğŸ”— ä»£ç å®ç°ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä¼šå‘˜è®¢é˜…

```javascript
async function subscribeMembership(planId, months) {
  const response = await fetch('/api/wp/v2/payment/create', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      type: 'membership',
      amount: 1500,
      method: 'wechat',
      device: 'mobile',
      title: 'VIPä¼šå‘˜å­£åº¦è´¹',
      plan_id: planId,
      duration_months: months,
      level: 'vip'
    })
  });
  return response.json();
}
```

### ç¤ºä¾‹ 2ï¼šå•†å“è´­ä¹°

```javascript
async function buyProduct(productId, quantity) {
  return await fetch('/api/wp/v2/payment/create', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      type: 'product',
      amount: 9900,
      method: 'alipay',
      device: 'desktop',
      title: 'iPhone 15 Pro',
      product_id: productId,
      quantity: quantity,
      remark: ''  // å¯é€‰
    })
  }).then(res => res.json());
}
```

### ç¤ºä¾‹ 3ï¼šè®¢å•ç±»å‹åˆ¤æ–­

```javascript
// æ ¹æ®è®¢å•ç±»å‹æ˜¾ç¤ºä¸åŒè¯¦æƒ…
function showOrderDetails(order) {
  switch(order.type) {
    case 'membership':
      return <MembershipDetail order={order} />;
    case 'product':
      return <ProductDetail order={order} />;
    case 'service':
      return <ServiceDetail order={order} />;
    case 'recharge':
      return <RechargeDetail order={order} />;
    case 'donation':
      return <DonationDetail order={order} />;
  }
}
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å›¢é˜Ÿæˆ–æŸ¥çœ‹ï¼š
- Git Commit: `821688e` (æ¶æ„å‡çº§)
- Git Commit: `a50479c` (å‚æ•°ä¼˜åŒ–)
- æµ‹è¯•è®¢å•å·: `202512200631520013673`

---

**ç”Ÿæˆæ—¶é—´ï¼š** 2025-12-20  
**æ¶‰åŠ Commitsï¼š** 6e5648e...a50479c (6 commits)  
**æ ¸å¿ƒæ”¹åŠ¨ï¼š** è®¢å•ç³»ç»Ÿæ¶æ„å‡çº§ + å‚æ•°è®¾è®¡ä¼˜åŒ–
